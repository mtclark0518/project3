{"version":3,"sources":["../../../../src/app/typescripts/free/modals/modal.service.ts"],"names":[],"mappings":"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","file":"modal.service.js","sourceRoot":"","sourcesContent":["import { ComponentRef, Injectable, TemplateRef, EventEmitter } from '@angular/core';\r\n\r\nimport { ComponentLoader } from '../utils/component-loader';\r\nimport { ComponentLoaderFactory } from '../utils/component-loader';\r\nimport { ModalBackdropComponent } from './modalBackdrop.component';\r\nimport { ModalContainerComponent } from './modalContainer.component';\r\nimport { MDBModalRef, ClassName, modalConfigDefaults, ModalOptions, TransitionDurations } from './modal.options';\r\n\r\n\r\nexport class MDBModalService {\r\n  // constructor props\r\n  public config: ModalOptions = modalConfigDefaults;\r\n\r\n  public onShow: EventEmitter<any> = new EventEmitter();\r\n  public onShown: EventEmitter<any> = new EventEmitter();\r\n  public onHide: EventEmitter<any> = new EventEmitter();\r\n  public onHidden: EventEmitter<any> = new EventEmitter();\r\n\r\n  protected isBodyOverflowing = false;\r\n  protected originalBodyPadding = 0;\r\n\r\n  protected scrollbarWidth = 0;\r\n\r\n  protected backdropRef: ComponentRef<ModalBackdropComponent>;\r\n  private _backdropLoader: ComponentLoader<ModalBackdropComponent>;\r\n  private modalsCount = 0;\r\n  private lastDismissReason = '';\r\n\r\n  private loaders: ComponentLoader<ModalContainerComponent>[] = [];\r\n\r\n  public constructor(private clf: ComponentLoaderFactory) {\r\n    this._backdropLoader = this.clf.createLoader<ModalBackdropComponent>(null, null, null);\r\n  }\r\n\r\n  /** Shows a modal */\r\n  show(content: string | TemplateRef<any> | any, config?: any): MDBModalRef {\r\n    this.modalsCount++;\r\n    this._createLoaders();\r\n    this.config = Object.assign({}, modalConfigDefaults, config);\r\n    this._showBackdrop();\r\n    this.lastDismissReason = null;\r\n    return this._showModal(content);\r\n  }\r\n\r\n  hide(level: number) {\r\n    if (this.modalsCount === 1) {\r\n      this._hideBackdrop();\r\n      this.resetScrollbar();\r\n    }\r\n    this.modalsCount = this.modalsCount >= 1 ? this.modalsCount - 1 : 0;\r\n    setTimeout(() => {\r\n      this._hideModal(level);\r\n      this.removeLoaders(level);\r\n    }, this.config.animated ? TransitionDurations.BACKDROP : 0);\r\n  }\r\n\r\n  _showBackdrop(): void {\r\n    const isBackdropEnabled = this.config.backdrop || this.config.backdrop === 'static';\r\n    const isBackdropInDOM = !this.backdropRef || !this.backdropRef.instance.isShown;\r\n\r\n    if (this.modalsCount === 1) {\r\n      this.removeBackdrop();\r\n\r\n      if (isBackdropEnabled && isBackdropInDOM) {\r\n        this._backdropLoader\r\n        .attach(ModalBackdropComponent)\r\n        .to('body')\r\n        .show({isAnimated: this.config.animated});\r\n        this.backdropRef = this._backdropLoader._componentRef;\r\n      }\r\n    }\r\n  }\r\n\r\n  _hideBackdrop(): void {\r\n    if (!this.backdropRef) {\r\n      return;\r\n    }\r\n    this.backdropRef.instance.isShown = false;\r\n    const duration = this.config.animated ? TransitionDurations.BACKDROP : 0;\r\n    setTimeout(() => this.removeBackdrop(), duration);\r\n  }\r\n\r\n  _showModal(content: any): MDBModalRef {\r\n    const modalLoader = this.loaders[this.loaders.length - 1];\r\n    const mdbModalRef = new MDBModalRef();\r\n    const modalContainerRef = modalLoader\r\n    .provide({provide: ModalOptions, useValue: this.config})\r\n    .provide({provide: MDBModalRef, useValue: mdbModalRef})\r\n    .attach(ModalContainerComponent)\r\n    .to('body')\r\n    .show({content, isAnimated: this.config.animated});\r\n    modalContainerRef.instance.level = this.getModalsCount();\r\n    mdbModalRef.hide = () => {\r\n      modalContainerRef.instance.hide();\r\n    };\r\n    mdbModalRef.content = modalLoader.getInnerComponent() || null;\r\n    return mdbModalRef;\r\n  }\r\n\r\n  _hideModal(level: number): void {\r\n    const modalLoader = this.loaders[level - 1];\r\n    if (modalLoader) {\r\n      modalLoader.hide();\r\n    }\r\n  }\r\n\r\n  getModalsCount(): number {\r\n    return this.modalsCount;\r\n  }\r\n\r\n  setDismissReason(reason: string) {\r\n    this.lastDismissReason = reason;\r\n  }\r\n\r\n  protected removeBackdrop(): void {\r\n    this._backdropLoader.hide();\r\n    this.backdropRef = null;\r\n  }\r\n\r\n  /** AFTER PR MERGE MODAL.COMPONENT WILL BE USING THIS CODE*/\r\n  /** Scroll bar tricks */\r\n  /** @internal */\r\n  public checkScrollbar(): void {\r\n    this.isBodyOverflowing = document.body.clientWidth < window.innerWidth;\r\n    this.scrollbarWidth = this.getScrollbarWidth();\r\n  }\r\n\r\n  public setScrollbar(): void {\r\n    if (!document) {\r\n      return;\r\n    }\r\n\r\n    this.originalBodyPadding = parseInt(window.getComputedStyle(document.body).getPropertyValue('padding-right') || '0', 10);\r\n\r\n    if (this.isBodyOverflowing) {\r\n      document.body.style.paddingRight = `${this.originalBodyPadding + this.scrollbarWidth}px`;\r\n    }\r\n  }\r\n\r\n  private resetScrollbar(): void {\r\n    document.body.style.paddingRight = this.originalBodyPadding + 'px';\r\n  }\r\n\r\n  // thx d.walsh\r\n  private getScrollbarWidth(): number {\r\n    const scrollDiv = document.createElement('div');\r\n    scrollDiv.className = ClassName.SCROLLBAR_MEASURER;\r\n    document.body.appendChild(scrollDiv);\r\n    const scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;\r\n    document.body.removeChild(scrollDiv);\r\n    return scrollbarWidth;\r\n\r\n  }\r\n\r\n  private _createLoaders(): void {\r\n    const loader = this.clf.createLoader<ModalContainerComponent>(null, null, null);\r\n    this.copyEvent(loader.onBeforeShow, this.onShow);\r\n    this.copyEvent(loader.onShown, this.onShown);\r\n    this.copyEvent(loader.onBeforeHide, this.onHide);\r\n    this.copyEvent(loader.onHidden, this.onHidden);\r\n    this.loaders.push(loader);\r\n  }\r\n\r\n  private removeLoaders(level: number): void {\r\n    this.loaders.splice(level - 1, 1);\r\n    this.loaders.forEach((loader: ComponentLoader<ModalContainerComponent>, i: number) => {\r\n      loader.instance.level = i + 1;\r\n    });\r\n  }\r\n\r\n  private copyEvent(from: EventEmitter<any>, to: EventEmitter<any>) {\r\n    from.subscribe(() => {\r\n      to.emit(this.lastDismissReason);\r\n    });\r\n  }\r\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ComponentLoaderFactory, },\n];\n}\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}